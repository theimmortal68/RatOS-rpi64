name: Build MainsailOS

on:
  workflow_dispatch:

jobs:
  Mainsail-Base:
    runs-on: ubuntu-latest
    steps:
      - name: "ðŸ“ Create directories"
        run: |
          mkdir -p build

      - name: Download artifact zip using GitHub API
        working-directory: ./build
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Set these variables based on your artifact URL
          ARTIFACT_URL="https://api.github.com/repos/theimmortal68/ratos-rpi64/actions/artifacts/3723393988/zip"
          echo "Downloading artifact from $ARTIFACT_URL"
          curl -L -H "Authorization: Bearer $GITHUB_TOKEN" -o artifact.zip $ARTIFACT_URL

      - name: Extract artifact
        working-directory: ./build
        run: |
          unzip artifact.zip
          echo "Extracted files:"
          ls -l
          sha256sum raspios64-base.img > raspios64-base.img.sha256

      - name: "ðŸ›  Unpack and rename image"
        working-directory: ./build
        run: |
          # search for the image file in the build directory
          IMG_FILE=$(ls *.img.xz | head -n 1)
          echo "Found compressed Image file: ${IMG_FILE}"

          # extract the image file
          xz -d "${IMG_FILE}"

          DECOMPRESSED_FILE="${IMG_FILE%.xz}"
          echo "Image file: ${DECOMPRESSED_FILE}"

          # rename the image file
          mv "${DECOMPRESSED_FILE}" input.img

      - name: "ðŸ”Ž Show scripts"
        working-directory: ./scripts
        run: ls -la

  
