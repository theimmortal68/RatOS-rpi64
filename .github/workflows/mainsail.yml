name: Build MainsailOS

on:
  workflow_dispatch:

jobs:
  download-artifact:
    runs-on: ubuntu-latest
    steps:
      - name: Make Build Workspace
        run: mkdir build
        
      - name: Download RaspiOS Lite 64-Bit
        working-directory: build
        run: |
          curl -L --progress-bar -o raspios-lite.img.xz \
            https://downloads.raspberrypi.com/raspios_lite_arm64/images/raspios_lite_arm64-2025-05-13/2025-05-13-raspios-bookworm-arm64-lite.img.xz
            
      - name: Checkout mainsailos repo
        uses: actions/checkout@v4
        with:
          repository: theimmortal68/mainsailos
          ref: develop
          path: mainsailos

      - name: Check Workspace
        run: ls -lah

      - name: Run CustoPiZer
        uses: OctoPrint/CustoPiZer@v1.4.1
        with:
          workspace: "${{ github.workspace }}/build"
          scripts:  "${{ github.workspace }}/scripts"
